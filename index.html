<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ger-Nor-dle (Hard Mode)</title>
<style>
  body {
    font-family: Helvetica, Arial, sans-serif;
    text-align: center;
    background-color: #003548;
    color: white;
  }
  #game {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
  }
  .board {
    display: grid;
    grid-template-rows: repeat(6, 1fr);
    gap: 5px;
    margin-bottom: 20px;
  }
  .row {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 5px;
  }
  .tile {
    width: 60px;
    height: 60px;
    border: 2px solid #041c47;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    font-weight: bold;
    text-transform: uppercase;
    background-color: #121213;
    color: white;
    border-radius:5px;
  }
  .correct {
    background-color: #538d4e !important;
  }
  .present {
    background-color: #b59f3b !important;
  }
  .absent {
    background-color: #3a3a3c !important;
  }
  .keyboard {
    display: flex;
    flex-direction: column;
    gap: 5px;
    max-width: 600px;
  }
  .key-row {
    display: flex;
    justify-content: center;
    gap: 5px;
  }
  .key {
    padding: 10px;
    background-color: #818384;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    font-weight: bold;
    color: white;
    user-select: none;
  }
  #hintBtn {
  background: transparent;
  border: none;
  cursor: pointer;
  margin-top: 10px;
  display: none;
  color: #c9b458; /* lightbulb color */
  font-size: 1.5em;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: color 0.3s ease;
}
#hintBtn:hover {
  color: #f9d342; /* brighter yellow on hover */
}

  #newRoundBtn, #copyBtn {
 background-color: #e4e4e4;
 border: none;
 padding: 10px;
 font-weight: bold;
 font-size: 10pt;
 width: 10em;
 border-radius: 1rem;
 color: rgb(35, 35, 35);
 box-shadow: 0 0.4rem #1d1d1d;
 border: 2px solid #1d1d1d;
 cursor: pointer;
}
  #newRoundBtn:hover, #copyBtn:hover {
 background-color: #444444;
 color: #e9e9e9;
 transition: background-color 0.1s ease-in-out, color 0.1s ease-in-out;
}

  #hintText {
    display: none;
    margin-top: 5px;
    font-style: italic;
  }
  /* Fade-in styles for message */
  #message {
  font-size: 20pt;
  opacity: 0;
  }
  #message.show {
    opacity: 1;
  }


</style>
</head>
<body>

<h1>Ger-Nor-dle (Hard Mode)</h1>
<button id="hintBtn" onclick="showHint()" aria-label="Show Hint" title="Show Hint" style="border:none; border-radius:5px; cursor:pointer; display:none; color:black; display: inline-flex; align-items: center; justify-content: center;">
  <svg xmlns="http://www.w3.org/2000/svg" height="40" width="40" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;">
    <defs>
      <radialGradient id="bulbGlowSimple" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#fff8b8" />
        <stop offset="100%" stop-color="#ffd93b" />
      </radialGradient>
    </defs>
    <!-- Simplified bulb glass -->
    <ellipse cx="32" cy="24" rx="14" ry="20" fill="url(#bulbGlowSimple)" stroke="#bfa839" stroke-width="2"/>
    <!-- Simplified filament -->
    <line x1="24" y1="25" x2="40" y2="25" stroke="#b38600" stroke-width="2" />
    <line x1="32" y1="25" x2="32" y2="38" stroke="#b38600" stroke-width="2" />
    <!-- Simplified base -->
    <rect x="24" y="44" width="16" height="10" fill="#7a6a2a" stroke="#5c4f1f" rx="2" ry="2"/>
  </svg>
</button>
<p id="hintText"></p>

<div id="setup">
  <p>Player 1: Enter a secret word and optional hint</p>
  <input type="password" id="secretInput" maxlength="5" placeholder="Secret word" />
  <input type="text" id="hintInput" placeholder="Enter a hint (optional)" style="margin:auto; margin-top:5px; margin-bottom:5px; display:block; width:200px;" />
  <button onclick="startGame()">Start Game</button>
  <p id="urlShare"></p>
</div>

<div id="game">
  <p id="message"></p>
  <button id="newRoundBtn" style="display:none; margin:5px;" onclick="location.reload()"><span class="button_top">New Round</span></button>
  <button id="copyBtn" style="display:none; margin:5px;" onclick="copyResult()">Copy Result</button>
  <div id="board" class="board"></div>
  <div id="keyboard" class="keyboard"></div>
</div>

<script>
let secret = "";
let customHint = "";
let currentRow = 0;
let currentCol = 0;
const rows = 6;
const cols = 5;
let grid = [];
let keyColors = {};
let guessHistory = [];
let colorHistory = [];

// Base64 helpers
function base64Encode(str) {
  return btoa(unescape(encodeURIComponent(str)));
}
function base64Decode(str) {
  try {
    return decodeURIComponent(escape(atob(str)));
  } catch {
    return null;
  }
}

function getSecretFromURL() {
  const params = new URLSearchParams(window.location.search);
  const encodedWord = params.get("w");
  const encodedHint = params.get("h");
  if (!encodedWord) return null;
  const decodedWord = base64Decode(encodedWord);
  const decodedHint = encodedHint ? base64Decode(encodedHint) : "";
  if (decodedWord && /^[A-ZÆØÅ]{5}$/.test(decodedWord)) {
    customHint = decodedHint || "";
    return decodedWord.toUpperCase();
  }
  return null;
}

function updateURLWithWord(word, hint) {
  const url = new URL(window.location);
  const encodedWord = base64Encode(word);
  const encodedHint = base64Encode(hint || "");
  url.searchParams.set("w", encodedWord);
  if (hint) url.searchParams.set("h", encodedHint);
  window.history.replaceState({}, "", url);
  document.getElementById("urlShare").textContent = `Share this link to play: ${url.href}`;
}

function startGame() {
  const inputWord = document.getElementById("secretInput").value.trim().toUpperCase();
  const inputHint = document.getElementById("hintInput").value.trim();
  if (!inputWord) {
    alert("Please enter a secret word.");
    return;
  }
  if (inputWord.length !== 5 || !/^[A-ZÆØÅ]+$/.test(inputWord)) {
    alert("Secret word must be exactly 5 letters and can include Æ, Ø, Å.");
    return;
  }
  secret = inputWord;
  customHint = inputHint;
  updateURLWithWord(secret, customHint);
  beginGame();
}

function beginGame() {
  document.getElementById("setup").style.display = "none";
  document.getElementById("game").style.display = "flex";
  document.getElementById("hintBtn").style.display = customHint ? "inline-block" : "none";
  const msgEl = document.getElementById("message");
  msgEl.textContent = "";
  msgEl.classList.remove("show");
  document.getElementById("newRoundBtn").style.display = "none";
  document.getElementById("copyBtn").style.display = "none";
  document.getElementById("hintText").style.display = "none";

  grid = Array(rows).fill(null).map(() => Array(cols).fill(""));
  guessHistory = [];
  colorHistory = [];
  keyColors = {};
  currentRow = 0;
  currentCol = 0;

  initBoard();
  initKeyboard();
}

function initBoard() {
  const board = document.getElementById("board");
  board.innerHTML = "";
  for (let r = 0; r < rows; r++) {
    const rowDiv = document.createElement("div");
    rowDiv.classList.add("row");
    for (let c = 0; c < cols; c++) {
      const tile = document.createElement("div");
      tile.classList.add("tile");
      rowDiv.appendChild(tile);
    }
    board.appendChild(rowDiv);
  }
}

function initKeyboard() {
  const keyboard = document.getElementById("keyboard");
  keyboard.innerHTML = "";
  const layout = [
    ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P"],
    ["A", "S", "D", "F", "G", "H", "J", "K", "L", "Æ"],
    ["Enter", "Z", "X", "C", "V", "B", "N", "M", "Ø", "Å", "Backspace"],
  ];
  layout.forEach((row) => {
    const rowDiv = document.createElement("div");
    rowDiv.classList.add("key-row");
    row.forEach((key) => {
      const keyBtn = document.createElement("button");
      keyBtn.textContent = key;
      keyBtn.classList.add("key");
      keyBtn.onclick = () => handleKeyPress(key);
      rowDiv.appendChild(keyBtn);
    });
    keyboard.appendChild(rowDiv);
  });
}

function updateBoard() {
  const board = document.getElementById("board");
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const tile = board.children[r].children[c];
      tile.textContent = grid[r][c];
    }
  }
}

function handleKeyPress(key) {
  const msgEl = document.getElementById("message");
  if (msgEl.textContent.trim() === "You win!" || msgEl.textContent.trim() === "Game over!") return;

  if (/^[a-zA-ZÆØÅæøå]$/.test(key) && currentCol < cols) {
    grid[currentRow][currentCol] = key.toUpperCase();
    currentCol++;
    updateBoard();
  } else if (key === "Backspace" && currentCol > 0) {
    currentCol--;
    grid[currentRow][currentCol] = "";
    updateBoard();
  } else if (key === "Enter" && currentCol === cols) {
    submitGuess();
  }
}

window.addEventListener("keydown", (e) => {
  if (document.getElementById("game").style.display !== "flex") return;
  const key = e.key.toUpperCase();
  if (key === "BACKSPACE") {
    handleKeyPress("Backspace");
  } else if (key === "ENTER") {
    handleKeyPress("Enter");
  } else if (/^[A-ZÆØÅ]$/.test(key)) {
    handleKeyPress(key);
  }
});

function submitGuess() {
  const guess = grid[currentRow].join("");
  if (guess.length !== cols) return;

  // Hard mode check
  if (guessHistory.length > 0) {
    const lastColors = colorHistory[colorHistory.length - 1];
    const lastGuess = guessHistory[guessHistory.length - 1];

    // Greens stay in same position
    for (let i = 0; i < cols; i++) {
      if (lastColors[i] === "correct" && guess[i] !== lastGuess[i]) {
        alert(`Hard mode: The letter ${lastGuess[i]} must stay in position ${i + 1}.`);
        return;
      }
    }

    // All yellows must appear somewhere
    let requiredYellows = [];
    for (let i = 0; i < cols; i++) {
      if (lastColors[i] === "present") {
        requiredYellows.push(lastGuess[i]);
      }
    }
    for (let letter of requiredYellows) {
      if (!guess.includes(letter)) {
        alert(`Hard mode: Your guess must include the letter ${letter}.`);
        return;
      }
    }
  }

  guessHistory.push(guess);

  const colors = Array(cols).fill("absent");
  const secretLetters = secret.split("");

  // Greens
  for (let i = 0; i < cols; i++) {
    if (guess[i] === secret[i]) {
      colors[i] = "correct";
      secretLetters[i] = null;
    }
  }
  // Yellows
  for (let i = 0; i < cols; i++) {
    if (colors[i] === "correct") continue;
    const index = secretLetters.indexOf(guess[i]);
    if (index !== -1) {
      colors[i] = "present";
      secretLetters[index] = null;
    }
  }

  colorHistory.push(colors);

  const board = document.getElementById("board");
  for (let i = 0; i < cols; i++) {
    const tile = board.children[currentRow].children[i];
    tile.classList.add(colors[i]);
    keyColors[guess[i]] = colors[i];
  }
  updateKeyboardColors();

  const msgEl = document.getElementById("message");

  if (guess === secret) {
    msgEl.textContent = "You win!";
    msgEl.classList.add("show");
    document.getElementById("newRoundBtn").style.display = "inline-block";
    document.getElementById("copyBtn").style.display = "inline-block";
  } else if (currentRow === rows - 1) {
    msgEl.textContent = "Game over!";
    msgEl.classList.add("show");
    document.getElementById("newRoundBtn").style.display = "inline-block";
    document.getElementById("copyBtn").style.display = "inline-block";
  } else {
    currentRow++;
    currentCol = 0;
    // Clear message and fade out for next guess
    msgEl.textContent = "";
    msgEl.classList.remove("show");
  }
}

function updateKeyboardColors() {
  const keys = document.querySelectorAll(".key");
  keys.forEach((keyBtn) => {
    const letter = keyBtn.textContent;
    if (keyColors[letter]) {
      keyBtn.classList.remove("correct", "present", "absent");
      keyBtn.classList.add(keyColors[letter]);
    }
  });
}

function copyResult() {
  let attempts = guessHistory.length;
  let statusLine = `Ger-Nor-dle (${attempts}/${rows}) – Secret: ${secret}`;
  let lines = guessHistory.map((guess, idx) => {
    let colors = colorHistory[idx]
      .map((color) => {
        if (color === "correct") return "🟩";
        if (color === "present") return "🟨";
        return "⬛";
      })
      .join("");
    return `${guess} ${colors}`;
  });
  let text = statusLine + "\n" + lines.join("\n");
  navigator.clipboard.writeText(text);
  alert("Result copied to clipboard!");
}

function showHint() {
  const hintEl = document.getElementById("hintText");
  hintEl.textContent = customHint;
  hintEl.style.display = "block";
}

window.onload = () => {
  const wordFromURL = getSecretFromURL();
  if (wordFromURL) {
    secret = wordFromURL;
    document.getElementById("setup").style.display = "none";
    updateURLWithWord(secret, customHint);
    beginGame();
  }
};
</script>

</body>
</html>
